<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>A√ßougue Caraj√°</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {
      background: #fefefe;
      color: #333;
      font-family: 'Segoe UI', sans-serif;
      padding: 20px;
    }
    h1 {
      color: #4CAF50;
    }
    input, button {
      padding: 8px;
      margin: 5px 0;
      border: 1px solid #ccc;
      border-radius: 6px;
      width: 100%;
      font-size: 16px;
    }
    button {
      background-color: #a0e7e5;
      color: #333;
      font-weight: bold;
      cursor: pointer;
      transition: 0.3s;
    }
    button:hover {
      background-color: #b4f8c8;
    }
    .section {
      background: #ffffff;
      padding: 15px;
      margin-top: 20px;
      border: 1px solid #ddd;
      border-radius: 8px;
      box-shadow: 2px 2px 8px rgba(0,0,0,0.05);
    }
    .linha {
      display: flex;
      justify-content: space-between;
      padding: 4px 0;
      border-bottom: 1px dashed #ddd;
    }
    .linha:last-child {
      border-bottom: none;
    }
    .total {
      font-size: 1.4em;
      font-weight: bold;
      color: #4CAF50;
      margin-top: 10px;
      text-align: center;
    }
    label {
      font-weight: bold;
      margin-top: 10px;
      display: block;
    }
    datalist {
      display: none;
    }
  </style>
</head>
<body>

  <h1>ü•©üõí A√ßougue Caraj√°</h1>

  <label>Vendedor</label>
  <input type="text" id="estabelecimento" placeholder="Ex: Mateus" />

  <div class="section">
    <h3>Nova Venda</h3>
    <input type="text" id="produto" list="produtosLista" placeholder="Produto" />
    <datalist id="produtosLista"></datalist>
    <input type="number" id="quantidade" placeholder="Quantidade" value="1" />
    <input type="number" id="preco" placeholder="Pre√ßo unit√°rio (R$)" step="0.01" />
    <button onclick="adicionarProduto()">+ Adicionar Produto</button>

    <div id="carrinho"></div>
    <div class="total">Total da Venda: R$ <span id="totalVenda">0.00</span></div>
    <button onclick="finalizarVenda()">‚úÖ Finalizar Venda</button>
  </div>

  <div class="section">
    <h3>Vendas do Dia</h3>
    <div id="listaVendas"></div>
    <div class="total">Total do Dia: R$ <span id="totalDia">0.00</span></div>
    <button onclick="gerarRelatorio()">üìÑ Fechar Caixa</button>
    <button onclick="resetarCaixa()">üóëÔ∏è Limpar Caixa</button>
  </div>

  <script>
    let carrinho = [];
    let vendas = JSON.parse(localStorage.getItem("vendasSciFi") || "[]");
    let produtosUsados = JSON.parse(localStorage.getItem("produtosSciFi") || "[]");

    function atualizarDatalist() {
      const lista = document.getElementById("produtosLista");
      lista.innerHTML = "";
      produtosUsados.forEach((p) => {
        const opt = document.createElement("option");
        opt.value = p;
        lista.appendChild(opt);
      });
    }

    function adicionarProduto() {
      const nome = document.getElementById("produto").value.trim();
      const qtd = parseFloat(document.getElementById("quantidade").value);
      const preco = parseFloat(document.getElementById("preco").value);

      if (!nome || isNaN(qtd) || isNaN(preco))
        return alert("Preencha todos os campos.");

      carrinho.push({ nome, qtd, preco });
      if (!produtosUsados.includes(nome)) {
        produtosUsados.push(nome);
        localStorage.setItem("produtosSciFi", JSON.stringify(produtosUsados));
        atualizarDatalist();
      }

      document.getElementById("produto").value = "";
      document.getElementById("quantidade").value = 1;
      document.getElementById("preco").value = "";
      atualizarCarrinho();
    }

    function atualizarCarrinho() {
      const carrinhoDiv = document.getElementById("carrinho");
      carrinhoDiv.innerHTML = "";
      let total = 0;

      carrinho.forEach((item) => {
        const subtotal = item.qtd * item.preco;
        total += subtotal;
        carrinhoDiv.innerHTML += `
          <div class="linha">
            <span>${item.nome} (${item.qtd} √ó R$${item.preco.toFixed(2)})</span>
            <span>R$${subtotal.toFixed(2)}</span>
          </div>`;
      });

      document.getElementById("totalVenda").innerText = total.toFixed(2);
    }

    function finalizarVenda() {
      if (carrinho.length === 0) return alert("Nenhum produto na venda.");
      const total = parseFloat(document.getElementById("totalVenda").innerText);
      const estabelecimento =
        document.getElementById("estabelecimento").value ||
        "Estabelecimento N√£o Informado";

      const venda = {
        data: new Date().toLocaleString(),
        produtos: [...carrinho],
        total,
        estabelecimento,
      };

      vendas.push(venda);
      localStorage.setItem("vendasSciFi", JSON.stringify(vendas));
      carrinho = [];
      atualizarCarrinho();
      document.getElementById("totalVenda").innerText = "0.00";
      atualizarVendas();
      alert("Venda finalizada!");
    }

    function atualizarVendas() {
      const lista = document.getElementById("listaVendas");
      lista.innerHTML = "";
      let totalDia = 0;

      vendas.forEach((venda, i) => {
        totalDia += venda.total;
        let html = `
          <div class="linha"><strong>Venda ${i + 1}</strong> - ${venda.data}</div>
          <div><em>${venda.estabelecimento}</em></div>`;
        venda.produtos.forEach((p) => {
          html += `<div class="linha"><span>${p.nome} (${p.qtd} √ó R$${p.preco.toFixed(
            2
          )})</span><span>R$${(p.qtd * p.preco).toFixed(2)}</span></div>`;
        });
        html += `<div class="linha"><strong>Total:</strong><strong>R$${venda.total.toFixed(
          2
        )}</strong></div><hr>`;
        lista.innerHTML += html;
      });

      document.getElementById("totalDia").innerText = totalDia.toFixed(2);
    }

    function gerarRelatorio() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      let y = 10;
      let totalDia = 0;

      doc.setFont("helvetica", "bold");
      doc.setFontSize(12);
      doc.text("Relat√≥rio de Caixa ‚Äî Caixa Sci-Fi", 10, y);
      y += 10;
      doc.setFont("helvetica", "normal");
      doc.setFontSize(10);

      vendas.forEach((venda, i) => {
        doc.text(`Venda ${i + 1} - ${venda.data}`, 10, y);
        y += 6;
        doc.text(`Estabelecimento: ${venda.estabelecimento}`, 10, y);
        y += 6;
        venda.produtos.forEach((p) => {
          doc.text(
            `‚Ä¢ ${p.nome} - ${p.qtd} √ó R$${p.preco.toFixed(2)} = R$${(
              p.qtd * p.preco
            ).toFixed(2)}`,
            12,
            y
          );
          y += 6;
        });
        doc.text(`Total: R$${venda.total.toFixed(2)}`, 12, y);
        y += 10;
        totalDia += venda.total;
      });

      doc.setFont("helvetica", "bold");
      doc.setFontSize(12);
      doc.text(`TOTAL DO DIA: R$${totalDia.toFixed(2)}`, 10, y);
      y += 15;

      doc.setFont("helvetica", "italic");
      doc.setFontSize(10);
      const estabelecimento =
        document.getElementById("estabelecimento").value ||
        "Estabelecimento N√£o Informado";
      doc.text(`Relat√≥rio gerado por: ${estabelecimento}`, 10, y);
      doc.save("relatorio_caixa.pdf");
    }

    function resetarCaixa() {
      if (confirm("Tem certeza que deseja limpar todo o caixa do dia?")) {
        vendas = [];
        localStorage.removeItem("vendasSciFi");
        atualizarVendas();
        alert("Caixa zerado.");
      }
    }

    atualizarVendas();
    atualizarDatalist();
  </script>
</body>
</html>
