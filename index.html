<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Proposta Comercial | Enterprise</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #ffffff; --card: #f8fafc; --text: #1e293b; --primary: #2563eb;
            --border: #e2e8f0; --input: #ffffff; --muted: #64748b;
        }
        .dark-mode {
            --bg: #0f172a; --card: #1e293b; --text: #f1f5f9; --primary: #3b82f6;
            --border: #334155; --input: #0f172a; --muted: #94a3b8;
        }
        * { box-sizing: border-box; transition: background 0.3s; }
        body { background-color: var(--bg); color: var(--text); font-family: 'Inter', sans-serif; margin: 0; padding: 40px 20px; display: flex; justify-content: center; }
        .container { width: 100%; max-width: 800px; }
        
        .header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 30px; }
        .brand h1 { font-size: 1.5rem; margin: 0; font-weight: 700; letter-spacing: -0.5px; color: var(--primary); }
        .brand p { font-size: 0.85rem; color: var(--muted); margin: 5px 0 0; }

        .card { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 24px; margin-bottom: 20px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .card-title { font-size: 0.9rem; font-weight: 600; margin-bottom: 20px; text-transform: uppercase; letter-spacing: 0.5px; color: var(--muted); border-bottom: 1px solid var(--border); padding-bottom: 10px; }

        label { display: block; font-size: 0.75rem; font-weight: 500; margin-bottom: 6px; }
        input, textarea, select { width: 100%; padding: 10px; background: var(--input); border: 1px solid var(--border); border-radius: 6px; color: var(--text); font-family: inherit; font-size: 0.9rem; margin-bottom: 15px; }
        
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; }

        .item-row { display: grid; grid-template-columns: 2fr 80px 120px 40px; gap: 12px; align-items: center; margin-bottom: 10px; }
        .btn { cursor: pointer; border: none; border-radius: 6px; font-weight: 600; padding: 12px 20px; font-size: 0.9rem; }
        .btn-primary { background: var(--primary); color: white; width: 100%; }
        .btn-outline { background: transparent; border: 1px solid var(--primary); color: var(--primary); margin-top: 10px; width: 100%; }
        .btn-del { background: transparent; color: #ef4444; font-size: 1.2rem; }

        .total-box { text-align: right; padding: 20px 0; border-top: 2px solid var(--border); }
        .total-label { font-size: 0.8rem; color: var(--muted); font-weight: 600; }
        .total-value { font-size: 2rem; font-weight: 800; color: var(--primary); }

        .theme-toggle { position: fixed; top: 20px; right: 20px; background: var(--card); border: 1px solid var(--border); padding: 10px; border-radius: 50%; cursor: pointer; }
        #logo-preview { max-height: 40px; display: none; margin-bottom: 10px; }
    </style>
</head>
<body>

<button class="theme-toggle" onclick="document.body.classList.toggle('dark-mode')">üåì</button>

<div class="container">
    <div class="header">
        <div class="brand">
            <h1>Or√ßameintor Pro</h1>
            <p>Emissor de Propostas Executivas</p>
        </div>
        <div style="text-align: right;">
            <img id="logo-preview">
            <input type="file" id="file-logo" style="display:none" onchange="uploadLogo(this)">
            <label for="file-logo" style="cursor:pointer; color: var(--primary);">+ Upload Logo</label>
        </div>
    </div>

    <div class="card">
        <div class="card-title">Identifica√ß√£o Comercial</div>
        <div class="grid">
            <div><label>Cliente / Empresa</label><input type="text" id="cli" placeholder="Ex: Nexus Tech"></div>
            <div><label>Respons√°vel Emissor</label><input type="text" id="resp" placeholder="Seu Nome"></div>
        </div>
    </div>

    <div class="card">
        <div class="card-title">Escopo de Servi√ßos / Materiais</div>
        <div id="lista-itens"></div>
        <button class="btn btn-outline" onclick="addItem()">+ Adicionar Item</button>
    </div>

    <div class="card">
        <div class="card-title">Custos Operacionais (Opcional)</div>
        <div class="grid-3">
            <div><label>Dias de Trabalho</label><input type="number" id="dias" value="0" oninput="calc()"></div>
            <div><label>Total de Equipe</label><input type="number" id="equipe" value="0" oninput="calc()"></div>
            <div><label>Custo Di√°ria (R$)</label><input type="number" id="vDia" value="0" oninput="calc()"></div>
        </div>
    </div>

    <div class="card">
        <div class="card-title">Condi√ß√µes de Fechamento</div>
        <div class="grid">
            <div><label>Margem de Lucro (%)</label><input type="number" id="mrg" value="0" oninput="calc()"></div>
            <div><label>Validade da Proposta</label><input type="text" id="val" value="15 dias"></div>
        </div>
        <label>Observa√ß√µes T√©cnicas</label>
        <textarea id="obs" rows="3" placeholder="Garantia, prazos de entrega, forma de pagamento..."></textarea>
    </div>

    <div class="total-box">
        <div class="total-label">INVESTIMENTO TOTAL</div>
        <div class="total-value">R$ <span id="res-total">0,00</span></div>
    </div>

    <button class="btn btn-primary" onclick="generatePDF()">EMITIR PROPOSTA PDF</button>

    <p style="text-align: center; font-size: 0.7rem; color: var(--muted); margin-top: 30px;">
        Gerado por Estrat√©gia Nexus ‚Ä¢ Sistema Privado
    </p>
</div>

<script>
    let itens = [];
    let base64Logo = "";

    function uploadLogo(input) {
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = e => {
                base64Logo = e.target.result;
                const img = document.getElementById('logo-preview');
                img.src = base64Logo; img.style.display = 'block';
            };
            reader.readAsDataURL(input.files[0]);
        }
    }

    function addItem() {
        itens.push({ id: Date.now(), d: '', q: 1, v: 0 });
        render();
    }

    function u(id, f, v) { 
        const it = itens.find(x => x.id === id); 
        it[f] = f === 'd' ? v : parseFloat(v) || 0; 
        calc(); 
    }

    function rem(id) { itens = itens.filter(x => x.id !== id); render(); }

    function render() {
        const c = document.getElementById('lista-itens');
        c.innerHTML = '';
        itens.forEach(i => {
            const div = document.createElement('div');
            div.className = 'item-row';
            div.innerHTML = `
                <input type="text" placeholder="Servi√ßo" value="${i.d}" oninput="u(${i.id},'d',this.value)">
                <input type="number" placeholder="Qtd" value="${i.q}" oninput="u(${i.id},'q',this.value)">
                <input type="number" placeholder="Valor" value="${i.v}" oninput="u(${i.id},'v',this.value)">
                <button class="btn-del" onclick="rem(${i.id})">‚úï</button>
            `;
            c.appendChild(div);
        });
        calc();
    }

    function calc() {
        let sub = itens.reduce((acc, i) => acc + (i.q * i.v), 0);
        const d = parseFloat(document.getElementById('dias').value) || 0;
        const e = parseFloat(document.getElementById('equipe').value) || 0;
        const v = parseFloat(document.getElementById('vDia').value) || 0;
        const op = d * e * v;
        const mrg = (parseFloat(document.getElementById('mrg').value) || 0) / 100;
        const tot = (sub + op) * (1 + mrg);
        document.getElementById('res-total').innerText = tot.toLocaleString('pt-BR', {minimumFractionDigits: 2});
    }

    function generatePDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        const cli = document.getElementById('cli').value || 'Cliente';
        const mrg = (parseFloat(document.getElementById('mrg').value) || 0) / 100;
        const totalTxt = document.getElementById('res-total').innerText;

        // Visual Limpo no PDF
        if(base64Logo) try { doc.addImage(base64Logo, 'PNG', 160, 10, 35, 20); } catch(e){}
        
        doc.setFont("helvetica", "bold"); doc.setFontSize(20); doc.text("PROPOSTA COMERCIAL", 15, 25);
        doc.setFontSize(10); doc.setFont("helvetica", "normal"); doc.setTextColor(100);
        doc.text(`RESPONS√ÅVEL: ${document.getElementById('resp').value || 'N√£o informado'}`, 15, 35);
        doc.text(`CLIENTE: ${cli.toUpperCase()}`, 15, 40);
        doc.text(`DATA: ${new Date().toLocaleDateString('pt-BR')}`, 15, 45);

        let y = 65;
        doc.setFillColor(240); doc.rect(15, y-5, 180, 8, 'F');
        doc.setFont(undefined, 'bold'); doc.setTextColor(0);
        doc.text("DESCRI√á√ÉO DO SERVI√áO", 20, y); doc.text("VALOR TOTAL (C/ BDI)", 150, y);
        y += 10; doc.setFont(undefined, 'normal');

        // Itens
        itens.forEach(i => {
            if(y > 270) { doc.addPage(); y = 20; }
            const vComp = (i.q * i.v) * (1 + mrg);
            doc.text(i.d || 'Servi√ßo Geral', 20, y);
            doc.text(`R$ ${vComp.toLocaleString('pt-BR', {minimumFractionDigits: 2})}`, 150, y);
            y += 8;
        });

        // Condicional M√£o de Obra
        const d = parseFloat(document.getElementById('dias').value) || 0;
        const e = parseFloat(document.getElementById('equipe').value) || 0;
        if(d > 0 && e > 0) {
            const vOp = (d * e * (parseFloat(document.getElementById('vDia').value) || 0)) * (1 + mrg);
            doc.text(`Mobiliza√ß√£o de Equipe (${d} dias / ${e} pessoas)`, 20, y);
            doc.text(`R$ ${vOp.toLocaleString('pt-BR', {minimumFractionDigits: 2})}`, 150, y);
            y += 10;
        }

        y += 5; doc.setFontSize(12); doc.setFont(undefined, 'bold');
        doc.text(`TOTAL DO INVESTIMENTO: R$ ${totalTxt}`, 110, y);

        const obs = document.getElementById('obs').value;
        if(obs) {
            y += 20; doc.setFontSize(10); doc.text("OBSERVA√á√ïES E CONDI√á√ïES:", 15, y);
            doc.setFont(undefined, 'normal');
            doc.text(doc.splitTextToSize(obs, 175), 15, y + 7);
        }

        doc.setFontSize(8); doc.text(`Validade da Proposta: ${document.getElementById('val').value}`, 15, 285);
        doc.save(`Proposta_${cli}.pdf`);
    }
</script>
</body>
</html>
