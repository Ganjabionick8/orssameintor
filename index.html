<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>ðŸ¦¾ OrÃ§ameintor</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron&display=swap" rel="stylesheet" />
  <style>
    
    :root {
      --cor-primaria: #56e39f;
      --cor-secundaria: #20c997;
      --cor-fundo: #0a1f1c;
      --cor-texto: #d0f0e4;
      --cor-borda: #128c7e;
      --cor-bg-input: #144d45;
      --cor-hover: #3dffca;
      --cor-active: #17b287;
      --sombra-leve: rgba(0, 255, 204, 0.2);
      --sombra-intensa: rgba(0, 255, 204, 0.6);
      --espaco: 14px;
      --font-base: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      --font-mono: 'Orbitron', monospace;
    }

    body {
      background: var(--cor-fundo);
      color: var(--cor-texto);
      font-family: var(--font-base);
      padding: 24px;
      max-width: 640px;
      margin: auto;
      user-select: none;
      transition: background-color 0.5s ease, color 0.5s ease;
      -webkit-font-smoothing: antialiased;
    }

    body.light {
      --cor-fundo: #f5f7f9;
      --cor-texto: #2e2e2e;
      --cor-borda: #a8c0c0;
      --cor-bg-input: #e9f0f0;
      --cor-hover: #5aa897;
      --cor-active: #3b7a70;
      --sombra-leve: rgba(90, 168, 151, 0.3);
      --sombra-intensa: rgba(90, 168, 151, 0.6);
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 24px;
      user-select: text;
    }

    header h1 {
      font-family: var(--font-mono);
      font-weight: 900;
      font-size: 2.4rem;
      color: var(--cor-primaria);
      text-shadow: 0 0 8px var(--cor-primaria);
      margin: 0;
    }

    button.theme-toggle {
      background: linear-gradient(135deg, var(--cor-primaria), var(--cor-secundaria));
      border: none;
      padding: 10px 18px;
      border-radius: 12px;
      font-family: var(--font-mono);
      font-weight: 700;
      color: #0a1f1c;
      cursor: pointer;
      box-shadow: 0 0 10px var(--sombra-leve);
      transition: background 0.3s ease, box-shadow 0.3s ease;
      user-select: none;
    }
    button.theme-toggle:hover {
      background: linear-gradient(135deg, var(--cor-hover), var(--cor-secundaria));
      box-shadow: 0 0 20px var(--sombra-intensa);
    }
    button.theme-toggle:active {
      background: var(--cor-active);
      box-shadow: 0 0 12px var(--sombra-intensa);
    }

    label {
      display: block;
      font-weight: 600;
      margin-bottom: 8px;
      color: var(--cor-primaria);
      user-select: text;
      text-shadow: 0 0 4px var(--cor-primaria);
      font-size: 1rem;
    }

    input[type="text"],
    input[type="number"],
    input[type="date"],
    textarea {
      width: 100%;
      padding: 10px 14px;
      margin-bottom: var(--espaco);
      border-radius: 14px;
      border: 1.5px solid var(--cor-borda);
      background: var(--cor-bg-input);
      color: var(--cor-texto);
      font-size: 1.05rem;
      font-family: var(--font-base);
      box-shadow: inset 0 0 6px rgba(0,0,0,0.4);
      transition: border-color 0.3s ease, box-shadow 0.3s ease;
      user-select: text;
      resize: vertical;
    }
    input[type="text"]:focus,
    input[type="number"]:focus,
    input[type="date"]:focus,
    textarea:focus {
      border-color: var(--cor-hover);
      box-shadow: 0 0 14px var(--cor-hover);
      outline: none;
    }

    .item {
      display: flex;
      gap: var(--espaco);
      align-items: center;
      margin-bottom: var(--espaco);
      user-select: none;
    }

    .item input[type="text"] {
      flex: 3;
      user-select: text;
    }

    .item input[type="number"] {
      flex: 1;
      user-select: text;
    }

    button.remove-item {
      background: #e84545;
      border: none;
      color: #fff;
      padding: 8px 14px;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 700;
      font-family: var(--font-mono);
      box-shadow: 0 0 12px rgba(232, 69, 69, 0.5);
      transition: background-color 0.25s ease, box-shadow 0.25s ease;
      user-select: none;
    }
    button.remove-item:hover {
      background: #bf3636;
      box-shadow: 0 0 20px rgba(191, 54, 54, 0.75);
    }
    button.remove-item:active {
      background: #9b2e2e;
      box-shadow: 0 0 14px rgba(155, 46, 46, 0.9);
    }

    .btn {
      margin-top: 20px;
      background: linear-gradient(135deg, var(--cor-primaria), var(--cor-secundaria));
      border: none;
      padding: 14px 0;
      width: 100%;
      color: #0a1f1c;
      font-weight: 700;
      font-size: 1.2rem;
      border-radius: 18px;
      cursor: pointer;
      font-family: var(--font-mono);
      letter-spacing: 0.06em;
      box-shadow: 0 0 14px var(--sombra-leve);
      transition: background 0.3s ease, box-shadow 0.3s ease;
      user-select: none;
    }
    .btn:hover {
      background: linear-gradient(135deg, var(--cor-hover), var(--cor-secundaria));
      box-shadow: 0 0 28px var(--sombra-intensa);
    }
    .btn:active {
      background: var(--cor-active);
      box-shadow: 0 0 20px var(--sombra-intensa);
    }

    .btn-group {
      display: flex;
      gap: 14px;
      margin-top: 20px;
    }

    .btn-group .btn {
      flex: 1;
      padding: 12px 0;
      font-size: 1.05rem;
      letter-spacing: normal;
    }

    .total {
      margin-top: 32px;
      font-size: 2.4rem;
      font-weight: 900;
      color: var(--cor-hover);
      text-align: center;
      font-family: var(--font-mono);
      text-shadow: 0 0 20px var(--cor-hover);
      user-select: text;
    }

    footer {
      margin-top: 44px;
      font-size: 0.9rem;
      color: var(--cor-borda);
      text-align: center;
      font-style: italic;
      font-family: var(--font-base);
      user-select: text;
      text-shadow: 0 0 8px rgba(0, 0, 0, 0.2);
    }

    /* Modal */
    #modalCarregar {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.7);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      user-select: none;
    }
    #modalCarregar.active {
      display: flex;
    }
    #modalContent {
      background: var(--cor-bg-input);
      padding: 28px 32px;
      border-radius: 20px;
      max-width: 440px;
      width: 90%;
      color: var(--cor-texto);
      box-shadow: 0 0 24px var(--sombra-intensa);
      font-family: var(--font-base);
      max-height: 80vh;
      overflow-y: auto;
    }
    #modalContent h3 {
      margin-top: 0;
      font-family: var(--font-mono);
      color: var(--cor-primaria);
      font-weight: 800;
      font-size: 1.8rem;
    }
    #listaOrcamentos {
      margin-top: 18px;
      list-style: none;
      padding: 0;
      max-height: 320px;
      overflow-y: auto;
      user-select: none;
    }
    #listaOrcamentos li {
      background: var(--cor-fundo);
      border: 1.5px solid var(--cor-borda);
      border-radius: 12px;
      padding: 12px 16px;
      margin-bottom: 12px;
      cursor: pointer;
      font-weight: 600;
      user-select: none;
      color: var(--cor-texto);
      transition: background-color 0.2s ease, color 0.2s ease;
      font-family: var(--font-base);
    }
    #listaOrcamentos li:hover,
    #listaOrcamentos li:focus {
      background: var(--cor-primaria);
      color: #0a1f1c;
      outline: none;
      user-select: text;
    }
    #modalContent button.close-modal {
      margin-top: 26px;
      background: var(--cor-primaria);
      border: none;
      padding: 14px 20px;
      border-radius: 20px;
      font-weight: 700;
      cursor: pointer;
      color: #0a1f1c;
      font-family: var(--font-mono);
      transition: background-color 0.3s ease;
      user-select: none;
    }
    #modalContent button.close-modal:hover {
      background: var(--cor-hover);
    }
    #modalContent button.close-modal:active {
      background: var(--cor-active);
    }
  </style>
</head>
<body>

  <header>
    <h1>ðŸ¦¾ OrÃ§ameintor</h1>
    <button class="theme-toggle" aria-label="Trocar tema" title="Trocar tema" onclick="toggleTema()">ðŸ’¡</button>
  </header>

  <label for="cliente">Cliente</label>
  <input type="text" id="cliente" autocomplete="off" placeholder="Nome do cliente" />

  <label for="profissional">Profissional / Empresa</label>
  <input type="text" id="profissional" autocomplete="off" placeholder="Seu nome ou da empresa" />

  <label for="data">Data</label>
  <input type="date" id="data" />

  <div class="item-group">
    <h2>Itens Personalizados</h2>
    <div id="itensExtras"></div>
    <button type="button" class="btn" onclick="adicionarItem()">+ Adicionar Item</button>
  </div>

  <label for="observacoes">ObservaÃ§Ãµes</label>
  <textarea id="observacoes" rows="3" placeholder="Detalhes adicionais"></textarea>

  <div class="total">Total: R$ <span id="total">0,00</span></div>

  <div class="btn-group">
    <button type="button" class="btn" onclick="gerarPDF()">ðŸ§¾ Gerar PDF</button>
    <button type="button" class="btn" onclick="exportarJSON()">ðŸ’¾ Exportar JSON</button>
    <button type="button" class="btn" onclick="limparTudo()">ðŸ§¹ Limpar Tudo</button>
    <button type="button" class="btn" onclick="abrirModal()">ðŸ“‚ Carregar OrÃ§amento</button>
  </div>

  <footer>
     <span>ðŸ¦¾ OrÃ§ameintor &nbsp;&middot;&nbsp; Desenvolvido por <a href="https://github.com/Ganjabionick8" target="_blank" rel="noopener noreferrer" aria-label="GitHub Ganjabionick8">Ganjabionick8</a> &nbsp;&mdash;&nbsp; 2025</span>
  </footer>

  <!-- Modal Carregar -->
  <div id="modalCarregar" role="dialog" aria-modal="true" aria-labelledby="modalTitulo">
    <div id="modalContent">
      <h3 id="modalTitulo">OrÃ§amentos Salvos</h3>
      <ul id="listaOrcamentos"></ul>
      <button class="close-modal" onclick="fecharModal()">Fechar</button>
    </div>
  </div>

  <script>
    let itensExtras = [];

    // FunÃ§Ã£o para adicionar item com inputs alinhados e remover botÃ£o
    function adicionarItem(dados = null) {
      const container = document.getElementById("itensExtras");
      const index = itensExtras.length;
      itensExtras.push(index);

      const div = document.createElement("div");
      div.classList.add("item");
      div.setAttribute("data-index", index);
      div.innerHTML = `
        <input type="text" id="item_nome_${index}" placeholder="Nome do item" autocomplete="off" value="${dados?.nome || ''}" />
        <input type="number" id="item_qtd_${index}" min="0" step="1" value="${dados?.qtd || 0}" />
        <input type="number" id="item_preco_${index}" min="0" step="0.01" value="${dados?.preco || 0}" />
        <button type="button" class="remove-item" aria-label="Remover item" title="Remover item" onclick="removerItem(${index})">Ã—</button>
      `;
      container.appendChild(div);

      // Atualizar total ao digitar nos inputs do item
      div.querySelectorAll("input").forEach(input => {
        input.addEventListener("input", atualizarTotal);
      });

      atualizarTotal();
    }

    function removerItem(index) {
      const container = document.getElementById("itensExtras");
      const item = container.querySelector(`div[data-index="${index}"]`);
      if (item) {
        container.removeChild(item);
        itensExtras = itensExtras.filter(i => i !== index);
        atualizarTotal();
      }
    }

    // Atualizar total considerando apenas os itens extras (jÃ¡ que nÃ£o tem Ã¡rea, portas etc)
    function atualizarTotal() {
      let total = 0;
      itensExtras.forEach(i => {
        const qtd = parseFloat(document.getElementById(`item_qtd_${i}`)?.value) || 0;
        const preco = parseFloat(document.getElementById(`item_preco_${i}`)?.value) || 0;
        total += qtd * preco;
      });
      document.getElementById("total").innerText = total.toLocaleString('pt-BR', { minimumFractionDigits: 2 });
    }

    // BotÃ£o gerar PDF com cabeÃ§alho customizado
    function gerarPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      let y = 10;
      const lineHeight = 8;
      const marginLeft = 10;
      const maxLineWidth = 190;

      const cliente = document.getElementById("cliente").value || "N/A";
      const profissional = document.getElementById("profissional").value || "N/A";
      const data = document.getElementById("data").value || new Date().toLocaleDateString();
      const obs = document.getElementById("observacoes").value || "";
      const total = document.getElementById("total").innerText;

      // CabeÃ§alho customizado
      doc.setFont("helvetica", "bold");
      doc.setFontSize(18);
      doc.setTextColor(0, 200, 150);
      doc.text("ðŸ¦¾ OrÃ§ameintor", marginLeft, y);
      y += lineHeight * 1.5;

      doc.setFontSize(11);
      doc.setTextColor(30, 30, 30);
      doc.text(`Cliente: ${cliente}`, marginLeft, y);
      y += lineHeight;
      doc.text(`Profissional / Empresa: ${profissional}`, marginLeft, y);
      y += lineHeight;
      doc.text(`Data: ${data}`, marginLeft, y);
      y += lineHeight * 1.2;

      doc.setDrawColor(30, 200, 150);
      doc.setLineWidth(0.5);
      doc.line(marginLeft, y, marginLeft + maxLineWidth, y);
      y += lineHeight * 0.5;

      // Itens
      doc.setFont("helvetica", "bold");
      doc.setFontSize(13);
      doc.setTextColor(0, 150, 110);
      doc.text("Itens:", marginLeft, y);
      y += lineHeight;

      doc.setFont("helvetica", "normal");
      doc.setFontSize(11);
      doc.setTextColor(50, 50, 50);

      function addItem(nome, qtd, preco) {
        const texto = `${nome}: ${qtd} Ã— R$ ${preco.toLocaleString('pt-BR', { minimumFractionDigits: 2 })} = R$ ${(qtd * preco).toLocaleString('pt-BR', { minimumFractionDigits: 2 })}`;
        const splitText = doc.splitTextToSize(texto, maxLineWidth);
        doc.text(splitText, marginLeft, y);
        y += lineHeight * splitText.length;
      }

      itensExtras.forEach(i => {
        const nome = document.getElementById(`item_nome_${i}`)?.value || "(sem nome)";
        const qtd = parseFloat(document.getElementById(`item_qtd_${i}`)?.value) || 0;
        const preco = parseFloat(document.getElementById(`item_preco_${i}`)?.value) || 0;
        if(qtd > 0 && preco > 0) addItem(nome, qtd, preco);
      });

      y += lineHeight * 0.5;
      doc.setDrawColor(30, 200, 150);
      doc.setLineWidth(0.5);
      doc.line(marginLeft, y, marginLeft + maxLineWidth, y);
      y += lineHeight;

      doc.setFont("helvetica", "bold");
      doc.setFontSize(14);
      doc.setTextColor(0, 120, 80);
      doc.text(`Total: R$ ${total}`, marginLeft, y);
      y += lineHeight * 1.2;

      if (obs) {
        doc.setFont("helvetica", "italic");
        doc.setFontSize(11);
        doc.setTextColor(70, 70, 70);
        doc.text("ObservaÃ§Ãµes:", marginLeft, y);
        y += lineHeight;
        const splitObs = doc.splitTextToSize(obs, maxLineWidth);
        doc.text(splitObs, marginLeft, y);
      }

      doc.save(`Orcamento_${cliente.replace(/\s+/g, '_') || 'sem_nome'}.pdf`);
    }

    // Salvar orÃ§amento no localStorage
    function salvarOrcamento() {
      const cliente = document.getElementById("cliente").value.trim();
      if (!cliente) {
        alert("Informe o nome do cliente para salvar o orÃ§amento.");
        return;
      }
      const profissional = document.getElementById("profissional").value.trim();
      const data = document.getElementById("data").value;
      const observacoes = document.getElementById("observacoes").value.trim();

      const itens = itensExtras.map(i => {
        return {
          nome: document.getElementById(`item_nome_${i}`)?.value.trim() || '',
          qtd: parseFloat(document.getElementById(`item_qtd_${i}`)?.value) || 0,
          preco: parseFloat(document.getElementById(`item_preco_${i}`)?.value) || 0
        }
      });

      const orcamento = {
        cliente,
        profissional,
        data,
        observacoes,
        itens
      };

      let orcamentosSalvos = JSON.parse(localStorage.getItem("orcamentosSalvos") || "[]");

      // Substituir se jÃ¡ existir orÃ§amento para o cliente e data iguais
      const idxExistente = orcamentosSalvos.findIndex(o => o.cliente === cliente && o.data === data);
      if (idxExistente >= 0) {
        orcamentosSalvos[idxExistente] = orcamento;
      } else {
        orcamentosSalvos.push(orcamento);
      }

      localStorage.setItem("orcamentosSalvos", JSON.stringify(orcamentosSalvos));
      alert("OrÃ§amento salvo com sucesso!");
    }

    // Abrir modal carregar orÃ§amentos
    function abrirModal() {
      const modal = document.getElementById("modalCarregar");
      const lista = document.getElementById("listaOrcamentos");
      lista.innerHTML = "";

      let orcamentosSalvos = JSON.parse(localStorage.getItem("orcamentosSalvos") || "[]");
      if (orcamentosSalvos.length === 0) {
        lista.innerHTML = "<li>Nenhum orÃ§amento salvo.</li>";
      } else {
        orcamentosSalvos.forEach((orc, i) => {
          const li = document.createElement("li");
          li.tabIndex = 0;
          li.innerText = `${orc.cliente} â€” ${orc.data || 'sem data'}`;
          li.onclick = () => carregarOrcamento(i);
          li.onkeydown = e => { if (e.key === "Enter") carregarOrcamento(i) };
          lista.appendChild(li);
        });
      }

      modal.classList.add("active");
    }
    function fecharModal() {
      const modal = document.getElementById("modalCarregar");
      modal.classList.remove("active");
    }

    // Carregar orÃ§amento do localStorage
    function carregarOrcamento(index) {
      const orcamentosSalvos = JSON.parse(localStorage.getItem("orcamentosSalvos") || "[]");
      if (!orcamentosSalvos[index]) return;

      const orc = orcamentosSalvos[index];
      document.getElementById("cliente").value = orc.cliente;
      document.getElementById("profissional").value = orc.profissional;
      document.getElementById("data").value = orc.data || '';
      document.getElementById("observacoes").value = orc.observacoes || '';

      // Limpar itens atuais
      document.getElementById("itensExtras").innerHTML = '';
      itensExtras = [];

      orc.itens.forEach(item => {
        adicionarItem(item);
      });

      atualizarTotal();
      fecharModal();
    }

    // Exportar orÃ§amento para JSON (download)
    function exportarJSON() {
      const cliente = document.getElementById("cliente").value.trim() || 'sem_nome';
      const orcamentosSalvos = JSON.parse(localStorage.getItem("orcamentosSalvos") || "[]");

      const dataStr = JSON.stringify(orcamentosSalvos, null, 2);
      const blob = new Blob([dataStr], {type: "application/json"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = `orcamentos_salvos_${cliente.replace(/\s+/g, '_')}.json`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    // Limpar tudo (inputs e itens)
    function limparTudo() {
      if (!confirm("Deseja realmente limpar todos os dados?")) return;
      document.getElementById("cliente").value = '';
      document.getElementById("profissional").value = '';
      document.getElementById("data").value = '';
      document.getElementById("observacoes").value = '';
      document.getElementById("itensExtras").innerHTML = '';
      itensExtras = [];
      atualizarTotal();
    }

    // Alternar tema claro/escuro
    function toggleTema() {
      document.body.classList.toggle("light");
    }

    // Iniciar com um item para facilitar
    adicionarItem();

  </script>
</body>
</html>
